#!/bin/bash

# Multi-Camera Standalone 运行指南
# ================================

echo "Multi-Camera Standalone 系统运行指南"
echo "=================================="

echo ""
echo "1. 编译项目"
echo "----------"
echo "cd /home/cyberbus/driver_ws"
echo "colcon build --packages-select v4l2_camera --cmake-args -DCMAKE_BUILD_TYPE=Release"
echo "source install/setup.bash"

echo ""
echo "2. 检查相机设备"
echo "-------------"
echo "运行以下命令检查可用的相机设备："
echo "ls -la /dev/video*"
echo ""
echo "或使用提供的脚本："
echo "bash /home/cyberbus/driver_ws/src/ros2_v4l2_camera/scripts/check_camera_devices.sh"

echo ""
echo "3. 配置文件说明"
echo "-------------"
echo "配置文件路径: /home/cyberbus/driver_ws/src/ros2_v4l2_camera/config/camera_groups_config.yaml"
echo ""
echo "支持的设备组："
echo "- fisheye: /dev/video0, /dev/video1, /dev/video2, /dev/video3"
echo "- surround: /dev/video8, /dev/video9, /dev/video10, /dev/video11, /dev/video12, /dev/video13"
echo "- front: /dev/video5"

echo ""
echo "4. 运行方式"
echo "----------"

echo ""
echo "方式A: 使用launch文件（推荐）"
echo "----------------------------"
echo "# 启动fisheye组相机"
echo "ros2 launch v4l2_camera multi_camera_standalone.launch.py device_group:=fisheye"
echo ""
echo "# 启动surround组相机"
echo "ros2 launch v4l2_camera multi_camera_standalone.launch.py device_group:=surround"
echo ""
echo "# 启动front组相机"
echo "ros2 launch v4l2_camera multi_camera_standalone.launch.py device_group:=front"
echo ""
echo "# 自定义配置文件"
echo "ros2 launch v4l2_camera multi_camera_standalone.launch.py \\"
echo "  device_group:=fisheye \\"
echo "  config_file:=/path/to/your/config.yaml \\"
echo "  use_image_transport:=true \\"
echo "  convert_to_rgb:=false"

echo ""
echo "方式B: 直接运行可执行文件"
echo "----------------------"
echo "ros2 run v4l2_camera multi_camera_standalone --ros-args \\"
echo "  -p camera_config_file:=/home/cyberbus/driver_ws/src/ros2_v4l2_camera/config/camera_groups_config.yaml \\"
echo "  -p device_group:=fisheye \\"
echo "  -p frequency_monitor_enabled:=true \\"
echo "  -p frequency_monitor_interval:=2.0"

echo ""
echo "5. 参数说明"
echo "----------"
echo "- device_group: 要启动的设备组 (fisheye/surround/front)"
echo "- config_file: YAML配置文件路径"
echo "- use_image_transport: 是否使用image_transport (true/false)"
echo "- convert_to_rgb: 是否转换为RGB格式 (false=原始UYVY)"
echo "- frequency_monitor_enabled: 是否启用频率监控"
echo "- frequency_monitor_interval: 频率监控间隔（秒）"

echo ""
echo "6. 查看话题"
echo "----------"
echo "启动后，可以使用以下命令查看发布的话题："
echo ""
echo "# 查看所有话题"
echo "ros2 topic list"
echo ""
echo "# 查看图像话题"
echo "ros2 topic list | grep image"
echo ""
echo "# 查看特定话题信息"
echo "ros2 topic info /fisheye0/image_raw"
echo ""
echo "# 查看话题数据"
echo "ros2 topic echo /fisheye0/image_raw --once | head -20"

echo ""
echo "7. image_transport 功能"
echo "--------------------"
echo "当use_image_transport=true时，每个相机都会提供以下话题："
echo ""
echo "原始图像话题："
echo "- /fisheye0/image_raw"
echo "- /fisheye1/image_raw"
echo "- ..."
echo ""
echo "压缩图像话题（需要安装image_transport_plugins）："
echo "- /fisheye0/image_raw/compressed"
echo "- /fisheye1/image_raw/compressed"
echo "- ..."
echo ""
echo "其他格式（根据已安装的插件）："
echo "- /fisheye0/image_raw/theora"
echo "- /fisheye1/image_raw/theora"

echo ""
echo "8. 查看系统状态"
echo "-------------"
echo "运行中的系统会每5秒打印状态信息，包括："
echo "- 运行中的相机数量"
echo "- 每个相机的状态"
echo "- 频率统计（如果启用）"

echo ""
echo "9. 停止系统"
echo "----------"
echo "使用 Ctrl+C 停止系统"

echo ""
echo "10. 故障排除"
echo "-----------"
echo "如果遇到问题："
echo ""
echo "a) 检查设备权限："
echo "   sudo chmod 666 /dev/video*"
echo ""
echo "b) 检查设备是否被占用："
echo "   lsof /dev/video*"
echo ""
echo "c) 查看日志："
echo "   系统会在终端输出详细的日志信息"
echo ""
echo "d) 验证配置文件："
echo "   cat /home/cyberbus/driver_ws/src/ros2_v4l2_camera/config/camera_groups_config.yaml"

echo ""
echo "示例完整命令："
echo "=============="
echo ""
echo "# 编译并运行fisheye组"
echo "cd /home/cyberbus/driver_ws"
echo "colcon build --packages-select v4l2_camera"
echo "source install/setup.bash"
echo "ros2 launch v4l2_camera multi_camera_standalone.launch.py device_group:=fisheye"
